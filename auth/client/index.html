<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Authorize | MMM-OnSpotify</title>
  <link rel="stylesheet" href="assets/vendor/bootstrap@5.3.0-alpha1.min.css">
  <link rel="stylesheet" href="assets/styles.css">
</head>

<body>
  <div class="container">
    <div class="pb-md-4 pt-md-5">
      <div class="d-flex mb-2"
        style="display: flex!important;align-items: center;justify-content: space-between;align-content: center;flex-wrap: wrap;flex-direction: row;row-gap:10px">
        <img class="d-block" src="assets/logo-authservice.png" height="38">
        <a href="https://fabriz.co/?u=mmm-onspotify&s=authservice&t=app" target="_blank"><img class="d-block"
            src="assets/logo-fabrizz-githubgray.svg" height="38"></a>
      </div>
      <h1 class="display-4">MMM-OnSpotify</h1>
      <p class="lead" style="margin-top: -10px; margin-bottom: 0px;">A MagicMirror² that display what you are listening to using the Spotify Connect API</p>
    </div>


    <div class="px-2">
      <h2>Before we start:</h2>
      <p style="margin-bottom: 6px; margin-top: -6px;">To work correctly this module requires read access to the
        following <a href="https://developer.spotify.com/documentation/general/guides/authorization/scopes/"
          target="_blank">scopes</a> in your Spotify Account:</p>
      <ul class="list-group rounded-4" style="margin-bottom: 0.6em;">
        <li class="list-group-item py-2 px-3"><strong style="font-weight: 500;">Show what are you listening on
            Spotify.</strong> (Read your currently playing content and Spotify Connect devices information.) <span
            class="badge text-bg-secondary" style="margin-right: 6px;">user-read-playback-state</span><span
            class="badge text-bg-secondary">user-read-currently-playing</span></li>
        <li class="list-group-item py-2 px-3"><strong style="font-weight: 500;">Show cover art of albums/track when
            nothing is
            playing.</strong> (Read your top artists and content) <span
            class="badge text-bg-secondary">user-top-read</span>
        </li>
        <li class="list-group-item py-2 px-3"><strong style="font-weight: 500;">Show your account image and data when
            nothing
            is playing.</strong> (Access your subscription details) <span
            class="badge text-bg-secondary">user-read-private</span></li>
      </ul>

      

      <div class="alert alert-warning mb-4 rounded-4" role="alert">
          <ul style="margin: 0px;">
            <li>This <b>data is not shared</b> and stays in your mirror.</li>
            <li>You <b>cannot migrate your credentials from MMM-NowPlayingOnSpotify</b>, as they do not include every scope listed above.</li>
            <li>If you have multiple MM<sup>2</sup> instances, you need to create new Spotify Apps for each.</li>
            <li>This tool should be used in the <b>same device</b> as its hosted. You can run it in another device and then copy the config snippet</li>
          </ul>
      </div>
    </div>



    <div class="px-2">
      <h2>Instructions</h2>
      <div class="card text-bg-dark mb-3 rounded-4">
        <h4 class="card-header py-3">Step 1: Create a new Spotify app</h4>
        <div class="card-body">
          <div id="step1-placeholder" class="card-text"></div>
        </div>
      </div>

      <div class="card text-bg-dark mb-3 rounded-4" id="login">
        <h4 class="card-header py-3">Step 2: Authorize your app with your Spotify account</h4>
        <div class="card-body">
          <div id="form-placeholder"></div>
        </div>
      </div>

      <div id="loggedin">
        <div class="card text-bg-primary mb-3 rounded-4" style="background-color: #034c4a !important;">
          <h4 class="card-header py-3">Step 2: <span class="badge text-bg-success">Authorization complete!</span></h4>
          <div class="card-body">
            <div id="loggedin-placeholder"></div>
          </div>
        </div>
      </div>

      <div id="error"></div>

      <div id="step3-placeholder">
        <div class="card text-bg-dark mb-3 rounded-4">
          <h4 class="card-header py-3 placeholder-glow"><span class="badge text-bg-secondary placeholder">Waiting for
              authorization...</span> Step 3: Configure your mirror </h4>
        </div>
      </div>

      <div id="config-placeholder"></div>
    </div>

    <div class="pb-md-3">
      <div class="alert alert-info rounded-4" role="alert">
        <p style="margin: 0px;">This module is <strong>highly customizable</strong>, I recommend checking the <a
            href="https://github.com/Fabrizz/MMM-OnSpotify#theming-options">theming section in github</a>, to read about
          everything that you can enable / disable. You can also use MMM-OnSpotify to theme <a
            href="https://github.com/Fabrizz/MMM-OnSpotify#theming-other-mm2-modules">other MM2 modules</a> ("including
          the default ones!"). Animations are not recommended for a RPI 4 or below. Star the module in github!</p>
      </div>
    </div>


    <div class="px-2">
      <h2 class="mb-3">More by Fabrizz:</h2>
      <div class="row row-cols-1 row-cols-md-3 g-4 pb-md-3">
        <div class="col">
          <a href="https://github.com/Fabrizz/MMM-HomeKit"
            class="card h-100 text-bg-light border border-primary rounded-4"
            style="text-decoration: none; overflow: hidden;">
            <img src="assets/image-mmmhomekit.png" class="card-img-top">
            <div class="card-body">
              <h5 class="card-title">MMM-HomeKit <span class="badge text-bg-primary">NEW</span></h5>
              <p class="card-text">Control your mirror with <b>Homekit</b>, creating <b>native HK accessories</b>. Supports controlling third party modules and other automation systems like HomeAssistant!</p>
            </div>
          </a>
        </div>
        
        <div class="col">
          <a href="https://github.com/Fabrizz/MMM-LiveLyrics"
            class="card h-100 text-bg-light border border-primary rounded-4"
            style="text-decoration: none; overflow: hidden;">
            <img src="assets/image-mmmlivelyrics.png" class="card-img-top">
            <div class="card-body">
              <h5 class="card-title">MMM-LiveLyrics</h5>
              <p class="card-text">A module that extracts lyrics from the Genius Web interface. MMM-LivrLyrics is not recommended for new users, and it uses web scrapping to get the lyrics. Read more in the repository.</p>
            </div>
          </a>
        </div>

        <div class="col">
          <div class="card h-100 text-bg-dark rounded-4"
            style="text-decoration: none; overflow: hidden; background-color: #242424 !important">
            <div class="card-header" style="color: rgb(255, 229, 164);">
              Featured
            </div>
            <div class="card-body" style="display: flex; flex-flow: column nowrap;" style="color: rgb(255, 229, 164);">
              <h2 class="card-title"
                style="display: flex;column-gap: 0.24em;align-items: baseline; color: rgb(255, 229, 164);">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="height: 0.8em; display: inline;">
                  <path fill="currentColor"
                    d="M57.7 193l9.4 16.4c8.3 14.5 21.9 25.2 38 29.8L163 255.7c17.2 4.9 29 20.6 29 38.5v39.9c0 11 6.2 21 16 25.9s16 14.9 16 25.9v39c0 15.6 14.9 26.9 29.9 22.6c16.1-4.6 28.6-17.5 32.7-33.8l2.8-11.2c4.2-16.9 15.2-31.4 30.3-40l8.1-4.6c15-8.5 24.2-24.5 24.2-41.7v-8.3c0-12.7-5.1-24.9-14.1-33.9l-3.9-3.9c-9-9-21.2-14.1-33.9-14.1H257c-11.1 0-22.1-2.9-31.8-8.4l-34.5-19.7c-4.3-2.5-7.6-6.5-9.2-11.2c-3.2-9.6 1.1-20 10.2-24.5l5.9-3c6.6-3.3 14.3-3.9 21.3-1.5l23.2 7.7c8.2 2.7 17.2-.4 21.9-7.5c4.7-7 4.2-16.3-1.2-22.8l-13.6-16.3c-10-12-9.9-29.5 .3-41.3l15.7-18.3c8.8-10.3 10.2-25 3.5-36.7l-2.4-4.2c-3.5-.2-6.9-.3-10.4-.3C163.1 48 84.4 108.9 57.7 193zM464 256c0-36.8-9.6-71.4-26.4-101.5L412 164.8c-15.7 6.3-23.8 23.8-18.5 39.8l16.9 50.7c3.5 10.4 12 18.3 22.6 20.9l29.1 7.3c1.2-9 1.8-18.2 1.8-27.5zm48 0c0 141.4-114.6 256-256 256S0 397.4 0 256S114.6 0 256 0S512 114.6 512 256z" />
                </svg>
                fabriz.co
              </h2>
              <p class="card-text" style="margin-bottom: 12px; color: rgb(255, 229, 164);">My website! Here you can view
                more integrations and stuff that
                I’m working on. (Or going to work on, it’s not even finished yet!) <br><br> You can find more MM2
                modules and other projects on my personal Github. </p>
              <div style="flex:1;"></div>
              <div style="display: flex; flex-flow: row; gap: 8px; flex-wrap: wrap;">
                <a href="https://fabriz.co/?u=mmm-onspotify&s=authservice&t=app" class="btn btn-secondary rounded-3"
                  style="flex:1; display: inline-flex; align-items: center; justify-content: center; gap: 0.24em; background-color: rgb(255, 229, 164); color: #242424;">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"
                    style="height: 0.8em; display: inline; margin-top: 2px;">
                    <path fill="currentColor"
                      d="M57.7 193l9.4 16.4c8.3 14.5 21.9 25.2 38 29.8L163 255.7c17.2 4.9 29 20.6 29 38.5v39.9c0 11 6.2 21 16 25.9s16 14.9 16 25.9v39c0 15.6 14.9 26.9 29.9 22.6c16.1-4.6 28.6-17.5 32.7-33.8l2.8-11.2c4.2-16.9 15.2-31.4 30.3-40l8.1-4.6c15-8.5 24.2-24.5 24.2-41.7v-8.3c0-12.7-5.1-24.9-14.1-33.9l-3.9-3.9c-9-9-21.2-14.1-33.9-14.1H257c-11.1 0-22.1-2.9-31.8-8.4l-34.5-19.7c-4.3-2.5-7.6-6.5-9.2-11.2c-3.2-9.6 1.1-20 10.2-24.5l5.9-3c6.6-3.3 14.3-3.9 21.3-1.5l23.2 7.7c8.2 2.7 17.2-.4 21.9-7.5c4.7-7 4.2-16.3-1.2-22.8l-13.6-16.3c-10-12-9.9-29.5 .3-41.3l15.7-18.3c8.8-10.3 10.2-25 3.5-36.7l-2.4-4.2c-3.5-.2-6.9-.3-10.4-.3C163.1 48 84.4 108.9 57.7 193zM464 256c0-36.8-9.6-71.4-26.4-101.5L412 164.8c-15.7 6.3-23.8 23.8-18.5 39.8l16.9 50.7c3.5 10.4 12 18.3 22.6 20.9l29.1 7.3c1.2-9 1.8-18.2 1.8-27.5zm48 0c0 141.4-114.6 256-256 256S0 397.4 0 256S114.6 0 256 0S512 114.6 512 256z" />
                  </svg>
                  Fabriz.co
                </a>
                <a href="https://github.com/Fabrizz/" class="btn rounded-3"
                  style="flex:1; display: inline-flex; align-items: center; justify-content: center; gap: 0.24em; color: rgb(255, 229, 164); border: 1px solid rgb(255, 229, 164);">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"
                    style="height: 0.8em; display: inline; margin-top: 2px;">
                    <path fill="currentColor"
                      d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z" />
                  </svg>
                  Github
                </a>
              </div>
            </div>
          </div>
        </div>

      </div>

      <div class="pb-md-3">
        <div class="alert alert-secondary my-3 rounded-5" role="alert" style="margin-bottom: 0px;">
          <p class="px-1" style="margin-bottom: 8px;">This authentication module was originally developed by
            <a href="https://github.com/raywo" target="_blank">Raywo</a>, the original <a
              href="https://github.com/raywo/MMM-NowPlayingOnSpotify" target="_blank">MMM-NowPlayingOnSpotify</a>
            maintainer, based on the Spotify Auth Example. As its no longer maintained, <strong
              style="font-weight: 500;">MMM-OnSpotify</strong> was born,
            this version of the authentication Service includes some QOL changes, more functionality, and its easier
            to follow along. <strong style="font-weight: 100;">(V3.0 New Spotify developers dashboard)</strong>
          </p>
          <a href="/" class="btn btn-secondary rounded-4 px-3 mt-2">Need to start again? Click here</a>
        </div>
      </div>
    </div>


    <!-- Templates -->
    <script id="step1-template" type="text/x-handlebars-template">
      <p>First, we need to create a new Spotify App using the <a class="link-info" href="https://developer.spotify.com/dashboard/login" target="_blank">Spotify Developers Portal</a>. After login in, click on the <strong style="border: 1px #a181fb solid;background-color: #3d00e642;border-radius: 0.5em;padding: 0.1em 0.32em;font-weight: 500;">Create app</strong> button.</p>
      <p>Next you need to provide a name and description, what you type doesn’t matter, as it’s just an internal app (Maybe you should use something you’ll recognize in the future). You can left the website blank.</p>
      <p>Now add <span class="badge text-bg-warning">http://127.0.0.1:8100/callback</span> as the redirect URI, so later Spotify knows to redirect here with the credentials.</p>
      <p>To finish the app configuration, click on the <strong style="border: 1px #cffcea solid;background-color: #00e6db21;border-radius: 0.5em;padding: 0.1em 0.32em;font-weight: 500;">Web API</strong> checkbox, accept the Spotify ToS and click on <strong style="border: 1px #a181fb solid;background-color: #3d00e642;border-radius: 0.5em;padding: 0.1em 0.32em;font-weight: 500;">Create</strong>.</p>
      <p>After successfully creating the app you’ll land on the app’s dashboard. Click on <strong style="border: 1px #a181fb solid;background-color: #3d00e642;border-radius: 0.5em;padding: 0.1em 0.32em;font-weight: 500;">Settings</strong>, and then click on the <strong style="border: 1px #cffcea solid;background-color: #00e6db21;border-radius: 0.5em;padding: 0.1em 0.32em;font-weight: 500;">User Management</strong> tab.</p>
      <p>There, enter the email associated to your Spotify Account, in the "Full Name" section you can put whatever name/abreviation that you want. Click on <strong style="border: 1px #a181fb solid;background-color: #3d00e642;border-radius: 0.5em;padding: 0.1em 0.32em;font-weight: 500;">Add user</strong> to actually save your changes.</p>
      <p style="margin-bottom: 4px;">Once you added yourself as a user, go back to the <strong style="border: 1px #cffcea solid;background-color: #00e6db21;border-radius: 0.5em;padding: 0.1em 0.32em;font-weight: 500;">Basic Information</strong> tab, there you can see your <span class="badge text-bg-warning">Client ID</span> and your <span class="badge text-bg-warning">Client Secret</span> (after clicking on “View client secret”). Check that the redirect URI is correct, then copy and paste both credentials onto the <strong>Step 2 card below.</strong></p>
    </script>

    <script id="user-profile-template" type="text/x-handlebars-template">
  <div class="media ml-5" style="display: flex;flex-direction: row;flex-wrap: nowrap;align-items: center;column-gap: 16px;">
    <span class="rounded-circle mr-3 column" style="height: 80px; width: 80px;background-image: url({{images.0.url}});background-color: #121513; background-size: cover; background-position: center;"> </span>
    <div class="column">
      <h5 class="mt-0 mb-0">{{display_name}}</h5>
      <p class=" mb-0 mt-0" style="color:#1db954"><strong>Your app is now authorized. You can start using it with your MagicMirror.</strong></p>
    </div>
  </div>
</script>


    <script id="error-template" type="text/x-handlebars-template">
		<a href="/" class="card text-bg-danger mb-3" style="display: block; text-decoration: none;">
			<h4 class="card-header py-3">Step 2: Something went wrong!</h4>
			<div class="card-body">
				<p style="margin-bottom: 0px;">Did you give permission to the app? If not you will not be able to use this module with your MagicMirror unless you
					authorize the app. (Click this red card to restart the tool)</p>
			</div>
		</a> 
</script>

    <script id="config-template" type="text/x-handlebars-template">
  {{#if success}}
          <div class="card text-bg-primary mb-3 rounded-4" style="background-color: #034c4a !important;">
            <h4 class="card-header py-3">Step 3: Configure your mirror</h4>
            <div class="card-body">
                <p style="margin-bottom:0px">Now copy the following snippet into your <span class="badge text-bg-warning">config.js</span> file and your good to go!</p>
                <pre class="px-2 py-2 mt-2" style="background-color: #022423;border-radius: 0.6em; scrollbar-width: none; overflow: -moz-scrollbars-none; margin-bottom: 0px;" id="pre">
{
    <span style="color: rgba(255, 141, 141, 0.66);">/* Don't share your credentials! */</span>
    module: <span style="color: rgb(242, 210, 152);">"MMM-OnSpotify"</span>,
    position: <span style="color: rgb(242, 210, 152);">"bottom_right"</span>, <span style="color: rgba(255, 255, 255, 0.48);">/* bottom_left, bottom_center */</span>
        config: {
        clientID: <span style="color: rgb(242, 210, 152);">"{{clientID}}"</span>,
        clientSecret: <span style="color: rgb(242, 210, 152);">"{{clientSecret}}"</span>,
        accessToken: <span style="color: rgb(242, 210, 152);">"{{accessToken}}"</span>,
        refreshToken: <span style="color: rgb(242, 210, 152);">"{{refreshToken}}"</span>,
        <span style="color: rgba(255, 255, 255, 0.48);">/* Add here your configurations */</span>
    }
},</pre>
		
				<div class="alert mt-3 rounded-3 alert-light" role="alert" style="margin-bottom: 0px;">
					<p style="margin-bottom: 0px;">This is the minimal configuration. Its highly recommended to read the <a class="" href="https://github.com/Fabrizz/MMM-OnSpotify" target="_blank">configuration section</a> in the repository to customize the look and behaviour of the module.</p>
				</div>

          	</div>
          </div>
    <h1 class="display-4" style="margin-bottom: 60px;">Have fun!</h1>
  {{/if}}
</script>


    <script id="form-template" type="text/x-handlebars-template">
  <p style="margin-bottom: 10px;">Now you’ll need to give <strong style="font-weight: 500;">MMM-OnSpotify</strong> access to your Spotify Account. Enter your <span class="badge text-bg-warning">Client ID</span> and <span class="badge text-bg-warning">Client Secret</span> pair below:</p>

  <form action="/login" method="post">
    <div class="row">
      <div class="col">
        <label for="clientID" style="margin-bottom: 4px;">Client ID</label>
        <input type="text" name="clientID" autocomplete="off" class="form-control rounded-3 {{clientIDClass}}" id="clientID" placeholder="Enter your Client ID" value="{{clientIDValue}}">
        <div class="{{clientIDFeedbackClass}}">
          {{clientIDFeedBackText}}
        </div>
      </div>
      <div class="col">
        <label for="clientSecretID" style="margin-bottom: 4px;">Client Secret</label>
        <input type="text" name="clientSecret" autocomplete="off" class="form-control rounded-3 {{clientSecretClass}}" id="clientSecretID" placeholder="Enter your Client Secret" value="{{clientSecretValue}}">
        <div class="{{clientSecretFeedbackClass}}">
          {{clientSecretFeedBackText}}
        </div>
      </div>
    </div>
    <input type="hidden" name="redirectURI" id="redirectURIField" value="{{redirectURI}}">
    <div class="row" style="margin-top: 10px;">
      <div>
        <button type="submit" class="btn btn-info rounded-3">Authorize my app!</button>
      </div>
    </div>
  </form>
</script>


    <!-- Scripts -->
    <script src="assets/vendor/bootstrap@5.3.0-alpha1.bundle.min.js"></script>
    <script src="assets/vendor/handlebars2.0.0-alpha.1.min.js"></script>
    <script src="assets/vendor/jquery-1.10.1.min.js"></script>
    <script src="assets/clientLogic.js"></script>
</body>

</html>